<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SICU Schedule Manager™</title>
    <meta name="description" content="Professional workforce scheduling and management tool">
    <meta name="keywords" content="schedule, workforce, management, calendar, shifts">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Firebase SDKs (Compat for simple script usage) -->
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>
    <!-- Firebase App Initialization -->
    <script src="firebase-config.js"></script>
</head>
<body>
    <!-- Auth UI -->
    <div id="authContainer" style="display:none; max-width:420px; margin:40px auto; padding:20px; border:1px solid #e5e7eb; border-radius:8px; background:#fff;">
        <h2 style="margin-bottom:12px;">Sign in to SICU Schedule Manager</h2>
        <div class="form-group">
            <label for="authEmail">Email</label>
            <input type="email" id="authEmail" placeholder="you@example.com" style="width:100%; padding:10px; margin-top:6px;">
        </div>
        <div class="form-group" style="margin-top:10px;">
            <label for="authPassword">Password</label>
            <input type="password" id="authPassword" placeholder="••••••••" style="width:100%; padding:10px; margin-top:6px;">
        </div>
        <div style="display:flex; gap:10px; margin-top:16px;">
            <button id="loginBtn" class="btn btn-primary" style="flex:1;">Sign In</button>
            <button id="registerBtn" class="btn btn-primary" style="flex:1; background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); border-color: #6b7280;" onmouseover="this.style.background='linear-gradient(135deg, #4b5563 0%, #374151 100%)'" onmouseout="this.style.background='linear-gradient(135deg, #6b7280 0%, #4b5563 100%)'">Create Account</button>
        </div>
        <div style="margin-top:12px; font-size:14px; color:#6b7280; text-align:center;">
            <p style="margin:0;">Already have an account? <strong>Sign In</strong></p>
            <p style="margin:4px 0 0 0;">New user? <strong>Create Account</strong> (requires admin approval)</p>
            <p style="margin:8px 0 0 0;"><a href="#" id="forgotPasswordLink" style="color:#3b82f6; text-decoration:underline; cursor:pointer;">Forgot Password?</a></p>
        </div>
        <div id="authError" style="color:#b91c1c; margin-top:10px; display:none;"></div>
        <div id="authSuccess" style="color:#059669; margin-top:10px; display:none;"></div>
    </div>

    <!-- Email Verification UI -->
    <div id="verifyContainer" style="display:none; max-width:520px; margin:40px auto; padding:20px; border:1px solid #e5e7eb; border-radius:8px; background:#fff;">
        <h2 style="margin-bottom:6px;">Verify your email</h2>
        <p id="verifyMessage" style="margin:0 0 12px 0; color:#374151;">We've sent a verification link to your email. Please verify to continue.</p>
        <div style="display:flex; gap:10px;">
            <button id="resendVerifyBtn" class="btn btn-primary">Resend verification email</button>
            <button id="refreshVerifyBtn" class="btn btn-secondary">I've verified, refresh</button>
            <button id="verifySignOutBtn" class="btn btn-secondary">Sign out</button>
        </div>
        <div id="verifyError" style="color:#b91c1c; margin-top:10px; display:none;"></div>
        <div id="verifySuccess" style="color:#065f46; margin-top:10px; display:none;"></div>
    </div>

    <!-- Pending Approval UI -->
    <div id="pendingContainer" style="display:none; max-width:520px; margin:40px auto; padding:20px; border:1px solid #e5e7eb; border-radius:8px; background:#fff;">
        <h2 style="margin-bottom:6px;">Awaiting admin approval</h2>
        <p id="pendingMessage" style="margin:0 0 12px 0; color:#374151;">Your account is pending approval by an administrator.</p>
        <div style="display:flex; gap:10px;">
            <button id="pendingRefreshBtn" class="btn btn-secondary">Check status</button>
            <button id="pendingSignOutBtn" class="btn btn-secondary">Sign out</button>
        </div>
        <div id="pendingInfo" style="color:#065f46; margin-top:10px; display:block;">If urgent, contact your administrator.</div>
    </div>

    <div id="appContainer" class="container" style="display:none;">
        <header class="header">
            <h1><i class="fas fa-users-cog"></i> SICU Schedule Manager™</h1>
            <div class="navigation-tabs">
                <button id="calendarTab" class="nav-tab active">
                    <i class="fas fa-calendar-alt"></i> Calendar
                </button>
                <button id="rulesTab" class="nav-tab">
                    <i class="fas fa-cogs"></i> Rules
                </button>
                <button id="usersTab" class="nav-tab">
                    <i class="fas fa-users"></i> Employees
                </button>
                <button id="shiftsTab" class="nav-tab">
                    <i class="fas fa-clock"></i> Shifts
                </button>
                <button id="rolesTab" class="nav-tab">
                    <i class="fas fa-user-tag"></i> Job Types
                </button>
                <button id="importTab" class="nav-tab">
                    <i class="fas fa-file-import"></i> Data Import
                </button>
                <button id="activityTab" class="nav-tab">
                    <i class="fas fa-history"></i> Activity Log
                </button>
                <button id="pmsGuideBtn" class="nav-tab">
                    <i class="fas fa-book"></i> PSM Guide
                </button>
                <div class="header-actions">
                    <button id="adminBtn" class="btn btn-secondary" title="Admin" style="display:none; margin-left:8px;"><i class="fas fa-shield"></i> Admin</button>
                    <button id="logoutBtn" class="btn btn-secondary" title="Sign out" style="display:none; margin-left:8px;"><i class="fas fa-right-from-bracket"></i> Logout</button>
                </div>
            </div>
        </header>

        <!-- Calendar View - Separate from main content -->
        <div id="calendarView" class="calendar-container">
            <div class="calendar-header">
                <div class="calendar-controls-row">
                    <div class="calendar-selectors">
                        <div class="filter-section">
                            <label>Time Interval:</label>
                            <div class="filter-toggles">
                                <select id="timeInterval" class="filter-btn">
                                    <option value="7">7 Days</option>
                                    <option value="14">14 Days</option>
                                    <option value="30">30 Days</option>
                                    <option value="42" selected>42 Days</option>
                                    <option value="90">90 Days</option>
                                </select>
                            </div>
                        </div>
                        <div class="filter-section">
                            <label>Start Date:</label>
                            <div class="filter-toggles">
                                <input type="date" id="calendarStartDate" class="filter-btn">
                            </div>
                        </div>
                        <div class="filter-section">
                            <label>Sort:</label>
                            <div class="filter-toggles">
                                <div class="data-dropdown" id="sortDropdown">
                                    <button id="sortMenuBtn" class="filter-btn" aria-haspopup="true" aria-expanded="false">
                                        <i class="fas fa-sort"></i> <span id="sortMenuLabel">Original</span> <i class="fas fa-chevron-down" style="opacity:0.7"></i>
                                    </button>
                                    <div id="sortMenu" class="dropdown-menu" role="menu" aria-hidden="true">
                                        <button class="dropdown-item" data-sort="original" role="menuitem"><i class="fas fa-minus"></i> Original Order</button>
                                        <button class="dropdown-item" data-sort="name-asc" role="menuitem"><i class="fas fa-arrow-up-a-z"></i> Name A-Z</button>
                                        <button class="dropdown-item" data-sort="name-desc" role="menuitem"><i class="fas fa-arrow-down-a-z"></i> Name Z-A</button>
                                        <div class="dropdown-separator"></div>
                                        <button class="dropdown-item" data-sort="group-asc" role="menuitem"><i class="fas fa-layer-group"></i> Group A→None</button>
                                        <button class="dropdown-item" data-sort="group-desc" role="menuitem"><i class="fas fa-layer-group"></i> Group None→A</button>
                                        <div class="dropdown-separator"></div>
                                        <button class="dropdown-item" data-sort="shift-asc" role="menuitem"><i class="fas fa-sun"></i> Day→Night</button>
                                        <button class="dropdown-item" data-sort="shift-desc" role="menuitem"><i class="fas fa-moon"></i> Night→Day</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="filter-section">
                            <label>Data:</label>
                            <div class="filter-toggles">
                                <div class="data-dropdown" id="dataDropdown">
                                    <button id="dataMenuBtn" class="filter-btn" aria-haspopup="true" aria-expanded="false">
                                        <i class="fas fa-database"></i> Data
                                        <i class="fas fa-chevron-down" style="opacity:0.7"></i>
                                    </button>
                                    <div id="dataMenu" class="dropdown-menu" role="menu" aria-hidden="true">
                                        <button id="dataSave" class="dropdown-item" role="menuitem"><i class="fas fa-save"></i> Save snapshot</button>
                                        <button id="dataRestore" class="dropdown-item" role="menuitem"><i class="fas fa-undo"></i> Restore snapshot</button>
                                        <button id="dataClear" class="dropdown-item" role="menuitem"><i class="fas fa-eraser"></i> Clear calendar</button>
                                        <div class="dropdown-separator"></div>
                                        <button id="safeDataConsistencyTest" class="dropdown-item" role="menuitem"><i class="fas fa-shield-alt"></i> Test data consistency (recommended)</button>
                                        <button id="dataConsistencyTest" class="dropdown-item" role="menuitem"><i class="fas fa-check-circle"></i> Test data consistency (full)</button>
                                        <div class="dropdown-separator"></div>
                                        <button id="dataReset" class="dropdown-item danger" role="menuitem"><i class="fas fa-trash"></i> Reset all data</button>
                                    </div>
                                </div>
                                <button id="snapshotBadge" class="filter-btn snapshot-badge" title="No snapshot saved">
                                    <i class="fas fa-save"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="calendar-filters">
                        
                        <div class="filter-section">
                            <label>Shift Filters:</label>
                            <div class="filter-toggles">
                                <button id="filterAllShifts" class="filter-btn active" data-filter="all-shifts">
                                    <i class="fas fa-clock"></i> All
                                </button>
                                <button id="filterDayShifts" class="filter-btn active" data-filter="day">
                                    <i class="fas fa-sun"></i> Day
                                </button>
                                <button id="filterNightShifts" class="filter-btn active" data-filter="night">
                                    <i class="fas fa-moon"></i> Night
                                </button>
                            </div>
                        </div>
                        <div class="filter-section">
                            <label>Role Filters:</label>
                            <div class="filter-toggles" id="roleFilters">
                                <button id="filterAllRoles" class="filter-btn active" data-filter="all-roles">
                                    <i class="fas fa-users"></i> All
                                </button>
                                <!-- Role filter buttons will be dynamically added here -->
                                <button id="filterChargeShifts" class="filter-btn charge-filter-btn" data-filter="charge-shifts" title="This filter overrides all other filters">
                                    <i class="fas fa-crown"></i> CN
                                </button>
                            </div>
                        </div>
                        <div class="filter-section">
                            <label>Count Filters:</label>
                            <div class="filter-toggles">
                                <button id="toggleWeekendColumns" class="filter-btn active" data-column="weekend">
                                    <i class="fas fa-calendar-weekend"></i> F/S/S
                                </button>
                                <button id="toggleVacationColumn" class="filter-btn active" data-column="vacation">
                                    <i class="fas fa-umbrella-beach"></i> VAC
                                </button>
                                <button id="toggleRequiredColumn" class="filter-btn active" data-column="required">
                                    <i class="fas fa-user-check"></i> REQ
                                </button>
                                <button id="toggleChargeColumn" class="filter-btn active" data-column="charge">
                                    <i class="fas fa-crown"></i> CN
                                </button>
                                <button id="toggleMoveColumn" class="filter-btn active" data-column="move">
                                    <i class="fas fa-exchange-alt"></i> MOV
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="calendar-actions"></div>
                </div>
            </div>

            <div class="schedule-matrix-container">
                <div class="schedule-matrix" id="scheduleMatrix"></div>
            </div>

            <!-- Worker Count Summary -->
            <div class="worker-count-summary-container">
                <div class="worker-count-summary" id="workerCountSummary"></div>
            </div>
        </div>

        <!-- Staffing Issues Floating Panel - Outside calendar container -->
        <div id="staffingIssuesPanel" class="staffing-issues-panel">
            <div class="panel-header">
                <div class="panel-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Staffing Issues</span>
                </div>
                <div class="panel-controls">
                    <button id="togglePanel" class="btn btn-icon">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                    <button id="closePanel" class="btn btn-icon">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="panel-content" id="panelContent">
                <!-- Filter buttons for issue types -->
                <div class="issues-filters">
                    <div class="filter-toggles">
                        <button id="filterErrors" class="filter-btn active" data-filter="error">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Errors</span>
                        </button>
                        <button id="filterWarnings" class="filter-btn active" data-filter="warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Warnings</span>
                        </button>
                        <button id="filterInfo" class="filter-btn active" data-filter="info">
                            <i class="fas fa-info-circle"></i>
                            <span>Info</span>
                        </button>
                    </div>
                </div>
                <div class="issues-list" id="issuesList">
                    <!-- Issues will be populated here -->
                </div>
                <div class="no-issues" id="noIssues">
                    <i class="fas fa-check-circle"></i>
                    <p>All shifts are properly staffed!</p>
                </div>
            </div>
        </div>

        <!-- PMS Guide Floating Panel - Outside calendar container -->
        <div id="pmsGuidePanel" class="pms-guide-panel" style="display: none;">
            <div class="panel-header">
                <div class="panel-title">
                    <i class="fas fa-book"></i>
                    <span>Predictive Staffing Model Guide</span>
                </div>
                <div class="panel-controls">
                    <button id="togglePmsPanel" class="btn btn-icon">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                    <button id="closePmsPanel" class="btn btn-icon">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="panel-content" id="pmsPanelContent">
                <div class="pms-guide-table-container">
                    <table class="pms-guide-table">
                        <thead>
                            <tr>
                                <th>Shift</th>
                                <th>Sun</th>
                                <th>Mon</th>
                                <th>Tue</th>
                                <th>Wed</th>
                                <th>Thu</th>
                                <th>Fri</th>
                                <th>Sat</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="shift-label">AM</td>
                                <td>9</td>
                                <td>9</td>
                                <td>11</td>
                                <td>12</td>
                                <td>12</td>
                                <td>12</td>
                                <td>11</td>
                            </tr>
                            <tr>
                                <td class="shift-label">Variance*</td>
                                <td>-1</td>
                                <td>2-3</td>
                                <td>1-2</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>-2</td>
                            </tr>
                            <tr>
                                <td class="shift-label">PM</td>
                                <td>8</td>
                                <td>10</td>
                                <td>12</td>
                                <td>12</td>
                                <td>12</td>
                                <td>12</td>
                                <td>9</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="pms-guide-footnote">
                        <small>* Negative values imply the likely need to consolidate and send nurses home, while positive values refer to the need for additional help for admissions</small>
                    </div>
                </div>
            </div>
        </div>

        <main class="main-content">
            <!-- Rules Management View -->
            <div id="rulesView" class="view">
                <div class="rules-header">
                    <h2>Staffing Rules Management</h2>
                    <div class="rules-actions">
                        <button id="addRuleBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Add New Rule
                        </button>
                    </div>
                </div>
                <div class="rules-content">
                    <div class="rules-list" id="rulesList">
                        <div class="loading-spinner">
                            <i class="fas fa-spinner fa-spin"></i> Loading rules...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Management View -->
            <div id="usersView" class="view">
                <div class="users-header">
                    <h2>Employee Management</h2>
                    <button id="addUserBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add Employee
                    </button>
                </div>
                <div class="users-content" id="usersContent">
                    <!-- Users list will be populated here -->
                </div>
            </div>

            <!-- Shifts Management View -->
            <div id="shiftsView" class="view">
                <div class="shifts-header">
                    <h2>Shift Types Management</h2>
                    <button id="addShiftBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add Shift Type
                    </button>
                </div>
                <div class="shifts-content" id="shiftsContent">
                    <!-- Shifts list will be populated here -->
                </div>
            </div>

            <!-- Job Roles Management View -->
            <div id="rolesView" class="view">
                <div class="roles-header">
                    <h2>Job Roles Management</h2>
                    <button id="addRoleBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add Job Role
                    </button>
                </div>
                <div class="roles-content" id="rolesContent">
                    <!-- Roles list will be populated here -->
                </div>
            </div>

            <!-- Data Import View -->
            <div id="importView" class="view">
                <div class="import-header">
                    <h2>Data Import/Export</h2>
                </div>
                <div class="import-content" id="importContent">

                    <div class="import-section">
                        <h3>Import XLSX Files</h3>
                        <p>Import employee schedule assignments from Excel files (.xlsx) with full shift type and schedule support.</p>
                        <div style="background: #e6fffa; padding: 10px; border-radius: 6px; margin-bottom: 15px; border-left: 4px solid #059669;">
                            <small><strong>XLSX Format:</strong> Name, Job Type, Day 1, Day 2, Day 3, ... (last 3 columns ignored)<br>
                            <strong>Sheets:</strong> Data should be in the first worksheet<br>
                            <strong>Features:</strong> Full shift type creation, automatic color assignment, proper date parsing<br>
                            <strong>Supported:</strong> .xlsx and .xls files</small>
                        </div>
                        <div class="file-upload">
                            <i class="fas fa-file-excel"></i>
                            <p>Click to select XLSX file</p>
                            <small>Supports: .xlsx, .xls files</small>
                            <input type="file" id="xlsxImportFile" accept=".xlsx,.xls">
                        </div>
                        <div id="xlsxProgress" style="display: none; margin-top: 20px;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="xlsxProgressFill"></div>
                            </div>
                            <p id="xlsxProgressText">Processing...</p>
                        </div>
                    </div>

                    <div class="import-section">
                        <h3>Data Preview</h3>
                        <div id="dataPreview" class="data-preview">
                            <p>Upload an XLSX file to convert and review the data before importing.</p>
                        </div>
                    </div>

                    
                </div>
            </div>

            <!-- Activity Log View -->
            <div id="activityView" class="view">
                <div class="activity-header">
                    <h2>Activity Log</h2>
                    <div class="activity-controls">
                        <select id="activityFilter" class="filter-select">
                            <option value="">All Activities</option>
                            <option value="employee">Employee Changes</option>
                            <option value="shift">Shift Changes</option>
                            <option value="role">Role Changes</option>
                            <option value="import">Data Import/Export</option>
                        </select>
                        <button id="refreshActivityBtn" class="btn btn-secondary">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>
                <div class="activity-content" id="activityContent">
                    <div class="activity-stats" id="activityStats">
                        <!-- Activity statistics will be populated here -->
                    </div>
                    <div class="activity-feed" id="activityFeed">
                        <div class="loading-spinner">
                            <i class="fas fa-spinner fa-spin"></i> Loading activity log...
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Employee Modal -->
    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="employeeModalTitle">Add New Employee</h3>
                <button id="closeEmployeeModal" class="btn btn-icon"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="employeeForm" class="employee-form">
                <div class="form-group">
                    <label for="employeeName">Full Name</label>
                    <input type="text" id="employeeName" name="name" required>
                </div>
                <div class="form-group">
                    <label for="employeeRole">Job Role</label>
                    <select id="employeeRole" name="roleId" required>
                        <option value="">Select a role</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="employeeShiftType">Shift Type</label>
                    <select id="employeeShiftType" name="shiftType">
                        <option value="auto">Auto-determine (based on schedules)</option>
                        <option value="Day">Day</option>
                        <option value="Night">Night</option>
                    </select>
                    <small style="color: #666; display: block; margin-top: 4px;">
                        Auto-determine will classify as Night if any shifts match "ANM N", "18*", or "Night*"
                    </small>
                </div>
                    <div class="form-actions">
                        <button type="button" id="cancelEmployee" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Employee</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Admin - User Management</h3>
                <button id="closeAdminModal" class="btn btn-icon"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <!-- Admin Panel Tabs -->
                <div class="admin-tabs">
                    <button id="adminTabPending" class="admin-tab active">
                        <i class="fas fa-clock"></i> Pending Approval
                    </button>
                    <button id="adminTabUsers" class="admin-tab">
                        <i class="fas fa-users"></i> All Users
                    </button>
                    <button id="adminTabSettings" class="admin-tab">
                        <i class="fas fa-cog"></i> Settings
                    </button>
                </div>
                
                <!-- Pending Users Tab -->
                <div id="adminTabPendingContent" class="admin-tab-content active">
                    <div class="admin-controls">
                        <h4>Users Pending Approval</h4>
                        <button id="clearPendingBtn" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Clear All Pending Users
                        </button>
                    </div>
                    <div id="pendingUsersList">Loading...</div>
                </div>
                
                <!-- All Users Tab -->
                <div id="adminTabUsersContent" class="admin-tab-content">
                    <div class="admin-controls">
                        <h4>All Registered Users</h4>
                        <div class="admin-filters">
                            <select id="adminUserFilter" class="filter-select">
                                <option value="all">All Users</option>
                                <option value="approved">Approved Only</option>
                                <option value="pending">Pending Only</option>
                            </select>
                            <button id="refreshUsersBtn" class="btn btn-secondary">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div id="allUsersList">Loading...</div>
                </div>
                
                <!-- Settings Tab -->
                <div id="adminTabSettingsContent" class="admin-tab-content">
                    <h4>Admin Settings</h4>
                    <div class="admin-settings">
                        <div class="setting-group">
                            <label>Admin Emails (comma-separated)</label>
                            <textarea id="adminEmailsList" rows="3" placeholder="admin1@example.com, admin2@example.com"></textarea>
                            <button id="updateAdminEmails" class="btn btn-primary">
                                <i class="fas fa-save"></i> Update Admin List
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Shift Type Modal -->
    <div id="shiftModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="shiftModalTitle">Add New Shift Type</h3>
                <button id="closeShiftModal" class="btn btn-icon"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="shiftForm" class="shift-form">
                <div class="form-group">
                    <label for="shiftName">Shift Name</label>
                    <input type="text" id="shiftName" name="name" required>
                </div>
                <div class="form-group">
                    <label for="shiftDescription">Description</label>
                    <textarea id="shiftDescription" name="description" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="shiftColor">Color</label>
                    <div class="color-picker">
                        <input type="radio" id="shift-color-blue" name="color" value="#3b82f6" checked>
                        <label for="shift-color-blue" class="color-option" style="background-color: #3b82f6;"></label>
                        <input type="radio" id="shift-color-green" name="color" value="#10b981">
                        <label for="shift-color-green" class="color-option" style="background-color: #10b981;"></label>
                        <input type="radio" id="shift-color-red" name="color" value="#ef4444">
                        <label for="shift-color-red" class="color-option" style="background-color: #ef4444;"></label>
                        <input type="radio" id="shift-color-yellow" name="color" value="#f59e0b">
                        <label for="shift-color-yellow" class="color-option" style="background-color: #f59e0b;"></label>
                        <input type="radio" id="shift-color-purple" name="color" value="#8b5cf6">
                        <label for="shift-color-purple" class="color-option" style="background-color: #8b5cf6;"></label>
                        <input type="radio" id="shift-color-pink" name="color" value="#ec4899">
                        <label for="shift-color-pink" class="color-option" style="background-color: #ec4899;"></label>
                        <input type="radio" id="shift-color-teal" name="color" value="#14b8a6">
                        <label for="shift-color-teal" class="color-option" style="background-color: #14b8a6;"></label>
                        <input type="radio" id="shift-color-orange" name="color" value="#f97316">
                        <label for="shift-color-orange" class="color-option" style="background-color: #f97316;"></label>
                        <input type="radio" id="shift-color-indigo" name="color" value="#6366f1">
                        <label for="shift-color-indigo" class="color-option" style="background-color: #6366f1;"></label>
                        <input type="radio" id="shift-color-gray" name="color" value="#6b7280">
                        <label for="shift-color-gray" class="color-option" style="background-color: #6b7280;"></label>
                        <input type="radio" id="shift-color-cyan" name="color" value="#06b6d4">
                        <label for="shift-color-cyan" class="color-option" style="background-color: #06b6d4;"></label>
                        <input type="radio" id="shift-color-lime" name="color" value="#84cc16">
                        <label for="shift-color-lime" class="color-option" style="background-color: #84cc16;"></label>
                        <input type="radio" id="shift-color-rose" name="color" value="#f43f5e">
                        <label for="shift-color-rose" class="color-option" style="background-color: #f43f5e;"></label>
                        <input type="radio" id="shift-color-amber" name="color" value="#f59e0b">
                        <label for="shift-color-amber" class="color-option" style="background-color: #f59e0b;"></label>
                        <input type="radio" id="shift-color-violet" name="color" value="#8b5cf6">
                        <label for="shift-color-violet" class="color-option" style="background-color: #8b5cf6;"></label>
                        <input type="radio" id="shift-color-emerald" name="color" value="#10b981">
                        <label for="shift-color-emerald" class="color-option" style="background-color: #10b981;"></label>
                    </div>
                </div>
                    <div class="form-actions">
                        <button type="button" id="cancelShift" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Shift Type</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Job Role Modal -->
    <div id="roleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="roleModalTitle">Add New Job Role</h3>
                <button id="closeRoleModal" class="btn btn-icon"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="roleForm" class="role-form">
                <div class="form-group">
                    <label for="roleName">Role Name</label>
                    <input type="text" id="roleName" name="name" required>
                </div>
                <div class="form-group">
                    <label for="roleDescription">Description</label>
                    <textarea id="roleDescription" name="description" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="roleDepartment">Department</label>
                    <input type="text" id="roleDepartment" name="department">
                </div>
                <div class="form-group">
                    <label for="rolePayRate">Hourly Pay Rate</label>
                    <input type="number" id="rolePayRate" name="payRate" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label for="roleColor">Badge Color</label>
                    <div class="color-picker">
                        <input type="radio" id="role-color-blue" name="color" value="#3b82f6" checked>
                        <label for="role-color-blue" class="color-option" style="background-color: #3b82f6;"></label>
                        <input type="radio" id="role-color-green" name="color" value="#10b981">
                        <label for="role-color-green" class="color-option" style="background-color: #10b981;"></label>
                        <input type="radio" id="role-color-red" name="color" value="#ef4444">
                        <label for="role-color-red" class="color-option" style="background-color: #ef4444;"></label>
                        <input type="radio" id="role-color-yellow" name="color" value="#f59e0b">
                        <label for="role-color-yellow" class="color-option" style="background-color: #f59e0b;"></label>
                        <input type="radio" id="role-color-purple" name="color" value="#8b5cf6">
                        <label for="role-color-purple" class="color-option" style="background-color: #8b5cf6;"></label>
                        <input type="radio" id="role-color-pink" name="color" value="#ec4899">
                        <label for="role-color-pink" class="color-option" style="background-color: #ec4899;"></label>
                        <input type="radio" id="role-color-teal" name="color" value="#14b8a6">
                        <label for="role-color-teal" class="color-option" style="background-color: #14b8a6;"></label>
                        <input type="radio" id="role-color-orange" name="color" value="#f97316">
                        <label for="role-color-orange" class="color-option" style="background-color: #f97316;"></label>
                        <input type="radio" id="role-color-indigo" name="color" value="#6366f1">
                        <label for="role-color-indigo" class="color-option" style="background-color: #6366f1;"></label>
                        <input type="radio" id="role-color-gray" name="color" value="#6b7280">
                        <label for="role-color-gray" class="color-option" style="background-color: #6b7280;"></label>
                    </div>
                </div>
                    <div class="form-actions">
                        <button type="button" id="cancelRole" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Job Role</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Schedule Assignment Modal -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="scheduleModalTitle">Assign Shift</h3>
                <button id="closeScheduleModal" class="btn btn-icon"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="scheduleForm" class="schedule-form">
                <div class="form-group">
                    <label for="scheduleEmployee">Employee</label>
                    <select id="scheduleEmployee" name="employeeId" required>
                        <option value="">Select an employee</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="scheduleShift">Shift Type</label>
                    <select id="scheduleShift" name="shiftId" required>
                        <option value="">Select a shift</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="scheduleDate">Date</label>
                    <input type="date" id="scheduleDate" name="date" required>
                </div>
                    <div class="form-actions">
                        <button type="button" id="cancelSchedule" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Assign Shift</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <script src="utils.js?v=1"></script>
    <script src="dataProcessor.js?v=1"></script>
    <script src="modalManager.js?v=1"></script>
    <script src="filterManager.js?v=1"></script>
    <script src="snapshotManager.js?v=1"></script>
    <script src="uiManager.js?v=1"></script>
    <script src="importManager.js?v=1"></script>
    <script src="EmployeeManager.js?v=1"></script>
    <script src="calendarRenderer.js?v=1"></script>
    <script src="viewRenderer.js?v=1"></script>
    <script src="firebaseManager.js?v=1"></script>
    <script src="hybridDataManager.js?v=1"></script>
    <script src="dataConsistencyManager.js?v=1"></script>
    <script src="dataConsistencyTests.js?v=1"></script>
    <script src="safeDataConsistencyTests.js?v=1"></script>
    <script src="debugLoopDetector.js?v=1"></script>
    <script src="authManager.js?v=1"></script>
    <script src="activityLogger.js?v=1"></script>
    <script src="ruleEngine.js?v=1"></script>
    <script src="ruleManager.js?v=1"></script>
    <script src="ruleSystemTest.js?v=1"></script>
    <!-- New refactored modules -->
    <script src="dataManager.js?v=1"></script>
    <script src="activityManager.js?v=1"></script>
    <script src="testManager.js?v=1"></script>
    <script src="initializationManager.js?v=1"></script>
    <script src="script.js?v=1"></script>
</body>
</html>
